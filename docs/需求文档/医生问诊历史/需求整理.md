# 医生问诊历史模块需求梳理

## 功能概述
记录和管理用户与AI医生的问诊历史，支持回顾历史问诊内容，继续历史对话。

---

## 详细需求分析

### 1. 历史记录功能
- **按照会话分组存储问诊记录**  
  - 每次用户与AI医生的交互应以会话为单位进行存储。
  - 支持多会话并行管理。
  
- **支持会话命名和管理**  
  - 用户可对会话进行自定义命名（如“感冒咨询”、“体检报告解读”）。
  - 提供会话描述字段，便于用户备注。

- **记录问诊时间、问题、回答等详细信息**  
  - 每条消息需记录时间戳。
  - 记录用户提问和AI医生的回答内容。
  - 可附加元数据（如疾病标签、咨询类型）。

---

### 2. 会话管理功能
- **创建新会话**  
  - 用户可随时发起新的问诊会话。
  - 新会话默认生成唯一标识符，并初始化为空。

- **继续历史会话**  
  - 用户可从历史会话列表中选择某个会话继续对话。
  - 系统自动加载该会话的所有历史消息。

- **删除/归档历史会话**  
  - 用户可删除不再需要的会话。
  - 支持归档功能，将不常用的会话移至归档区，减少主界面干扰。

- **会话分类**  
  - 按疾病类型分类（如“呼吸道疾病”、“消化系统疾病”）。
  - 按咨询类型分类（如“症状咨询”、“用药指导”、“健康建议”）。

---

### 3. 搜索与分析功能
- **全文搜索历史问诊内容**  
  - 支持对所有会话中的问题和回答进行全文检索。
  - 搜索结果高亮显示关键词。

- **按时间范围筛选**  
  - 用户可指定时间段（如“最近一周”、“某年某月”）筛选会话。

- **按关键词筛选**  
  - 支持通过关键词（如“咳嗽”、“高血压”）快速定位相关会话。

- **统计分析**  
  - **热门问题**：统计用户提问频率最高的问题。
  - **常见症状**：分析用户描述的症状分布。
  - 数据可视化：提供图表展示统计结果。

---

## 数据结构设计

### ConsultationSession（会话实体）
| 字段名          | 类型         | 描述                                   |
|-----------------|--------------|----------------------------------------|
| sessionId       | String       | 会话唯一标识符                        |
| userId          | String       | 用户唯一标识符                        |
| sessionName     | String       | 会话名称                              |
| description     | String       | 会话描述                              |
| startTime       | DateTime     | 会话开始时间                          |
| lastUpdateTime  | DateTime     | 最后一次更新时间                      |
| status          | Enum         | 会话状态（活跃、归档、已删除）        |
| category        | String       | 会话分类（疾病类型或咨询类型）        |

### ConsultationMessage（消息实体）
| 字段名          | 类型         | 描述                                   |
|-----------------|--------------|----------------------------------------|
| messageId       | String       | 消息唯一标识符                        |
| sessionId       | String       | 所属会话ID                            |
| senderType      | Enum         | 发送方类型（用户、AI医生）            |
| content         | String       | 消息内容                              |
| timestamp       | DateTime     | 消息发送时间                          |
| metadata        | JSON         | 元数据（如疾病标签、咨询类型）        |

---

## 系统集成点

### 1. 与现有AI问诊系统集成
- 实时同步用户与AI医生的对话内容。
- 调用AI问诊系统的接口获取回答内容。

### 2. 与用户系统集成
- 获取用户身份信息（如userId）。
- 支持用户登录状态下的个性化会话管理。

### 3. 与疾病知识库集成
- 关联会话与疾病知识库中的疾病词条。
- 在会话中自动标注可能的疾病标签。
- 提供疾病相关的扩展信息（如常见症状、治疗建议）。

---